<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéµ Audio Library | Rapogi Lwanda SDA</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f4f8;
      margin: 0;
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: #2d2d7c;
      margin-bottom: 40px;
    }

    .album {
      background: #aa65a1;
      padding: 5px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 40px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      align-content: start;
    }

    .album h3 {
      color: yellow;
      border-bottom: 1px solid #6729b8;
      padding-bottom: 10px;
      text-align: center;
      font-size: large;
    }

    .song-list {
      list-style: decimal inside;
      padding-left: 0;
      
    }

    .song-info {
      display: flex;
      align-items: start;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
      background-color: #1b4788;
      padding: 12px 16px;
      border-radius: 10px;
    }

    /* Visual indicator for currently playing audio */
    .song-info.playing {
      box-shadow: 0 0 18px rgba(255, 215, 0, 0.9);
      transform: translateY(-2px);
      border: 2px solid gold;
      background-color: #244ea8;
    }

    .song-info.playing .song-title {
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.6);
    }

    .song-title {
      font-weight: bold;
      flex: 1;
      min-width: 280px;
      max-width: 280px;
    }

    audio {
      width: 100%;
      outline: none;
      background-color: yellow;
      color: blue;
    }

    .download-btn {
      background-color: #00bfa5;
      color: white;
      text-decoration: none;
      padding: 6px 6px;
      border-radius: 6px;
      font-size: 10px;
      transition: background-color 0.3s ease;
      width: 40%;
    }

    .download-btn:hover {
      background-color: #1de9b6;
    }

    .upload-link {
      text-align: center;
      margin-top: 30px;
      display: flex;              /* enables horizontal alignment */
      justify-content: center;    /* centers them on the page */
      gap: 15px;                  /* adds space between buttons */
      flex-wrap: wrap;            /* makes them wrap nicely on mobile */
    }

    .upload-link a {
      text-decoration: none;
      background-color: #21c72e;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      display: inline-block;       /* keeps them side by side */
      transition: background-color 0.3s ease;
    }

    .upload-link a:hover {
      background-color: #1127b1;
    }

  </style>
</head>
<body>

  <h2>üìÄ Rapogi Lwanda SDA Church Albums</h2>

  {% if albums %}
    {% for album, songs in albums.items() %}
      <div class="album">
        <h3>{{ album }}</h3>
        <ol class="song-list">
          {% for song in songs %}
            <li>
              <div class="song-info">
                <span class="song-title">{{ song.title }}</span>
                <audio controls>
                  <source src="{{ song.url }}" type="audio/mpeg">
                  Your browser does not support the audio tag.
                </audio>
                <a class="download-btn" href="{{ song.url }}" download>‚¨áÔ∏è Download</a>
              </div>
            </li>
          {% endfor %}
        </ol>
      </div>
    {% endfor %}
  {% else %}
    <p style="text-align: center; color: #888;">No albums available yet.</p>
  {% endif %}

  {% if session.get('admin') %}
    <div class="upload-link">
      <a href="{{ url_for('audio.upload_album') }}">‚ûï Upload New Album</a>
      <a href="{{ url_for('home') }}">üè† Back to Home</a>
    </div>
  {% else %}
    <div class="upload-link">
      <a href="{{ url_for('home') }}">üè† Back to Home</a>
    </div>
  {% endif %}

  <script>
    // When one audio starts playing, pause all other audio elements
    // and add a visual `.playing` class to the corresponding .song-info.
    (function() {
      const audios = Array.from(document.querySelectorAll('audio'));
      if (!audios.length) return;

      function clearPlaying() {
        document.querySelectorAll('.song-info.playing').forEach(card => card.classList.remove('playing'));
      }

      audios.forEach(audio => {
        const card = audio.closest('.song-info');

        audio.addEventListener('play', () => {
          // Pause other audios
          audios.forEach(other => {
            if (other !== audio) {
              try { other.pause(); other.currentTime = 0; } catch (e) {}
            }
          });

          // Update visual state
          clearPlaying();
          if (card) card.classList.add('playing');
        });

        // Remove visual indicator on pause or end
        audio.addEventListener('pause', () => {
          if (card) card.classList.remove('playing');
        });
        audio.addEventListener('ended', () => {
          if (card) card.classList.remove('playing');
        });
      });
    })();
  </script>

</body>
</html>
